# 新規項目追加機能のテスト計画

## テストの目的
新しく実装した「新規項目追加」機能が正しく動作することを確認する。

## テスト環境
- バックエンド: AWS Lambda + Hono
- フロントエンド: React + TanStack Router/Start
- データベース: DynamoDB

## テストケース

### 1. UI表示テスト

#### 1.1 ボタン表示
- [ ] ダッシュボードのヘッダー右上に「新規追加」ボタンが表示される
- [ ] ボタンがPasskey設定ボタンの左側に配置される
- [ ] モバイル表示でも適切にレイアウトされる

#### 1.2 ダイアログ表示
- [ ] 「新規追加」ボタンをクリックするとダイアログが開く
- [ ] ダイアログのタイトルが「新しい項目を追加」と表示される
- [ ] 説明文が「カテゴリ、備考、金額、ユーザーを入力してください」と表示される

#### 1.3 フォームフィールド
- [ ] ユーザー名入力フィールドが表示される
- [ ] カテゴリ選択ドロップダウンが表示される
- [ ] カテゴリが日本語で表示される（家賃、光熱費など、家具/家電、日用品/食品、交通費、その他）
- [ ] 備考入力フィールドが表示される
- [ ] 金額入力フィールドが表示される（円記号付き）

### 2. バリデーションテスト

#### 2.1 必須フィールド
- [ ] ユーザー名が空の場合、エラーメッセージが表示される
- [ ] カテゴリが未選択の場合、エラーメッセージが表示される
- [ ] 金額が0の場合、警告またはエラーが表示される

#### 2.2 値の制限
- [ ] 金額に負の値を入力できない
- [ ] 備考が500文字を超えるとエラーメッセージが表示される
- [ ] 金額に数値以外を入力するとエラーメッセージが表示される

### 3. 機能テスト

#### 3.1 正常系
- [ ] すべてのフィールドに正しい値を入力
- [ ] 「追加する」ボタンをクリック
- [ ] トースト通知「新しい項目が追加されました」が表示される
- [ ] ダイアログが自動的に閉じる
- [ ] ダッシュボードのデータが自動的に更新される
- [ ] 追加した項目が該当月のテーブルに表示される

#### 3.2 キャンセル操作
- [ ] 「キャンセル」ボタンをクリックするとダイアログが閉じる
- [ ] データは保存されない
- [ ] 再度開くとフォームがリセットされている

#### 3.3 複数項目の追加
- [ ] 1つ目の項目を追加後、再度「新規追加」ボタンをクリック
- [ ] フォームが初期状態にリセットされている
- [ ] 2つ目の項目を追加できる
- [ ] 両方の項目がダッシュボードに表示される

### 4. データ整合性テスト

#### 4.1 DynamoDB保存確認
- [ ] 追加した項目がDynamoDBに正しく保存される
- [ ] PK（USER#userId）が正しい形式
- [ ] SK（COST#timestamp）が正しい形式
- [ ] GSI1PK（COST#YYYY-MM）が正しい形式
- [ ] GSI1SK（USER#userId#timestamp）が正しい形式
- [ ] YearMonth（YYYY-MM）が正しい形式
- [ ] CreatedAt/UpdatedAtが設定される
- [ ] TTLが設定されていない（永続データ）

#### 4.2 データの一貫性
- [ ] 追加直後のデータがバックエンドAPIで取得できる
- [ ] 月次集計に正しく反映される
- [ ] ユーザー別集計に正しく反映される
- [ ] カテゴリ別集計に正しく反映される

### 5. エラーハンドリングテスト

#### 5.1 ネットワークエラー
- [ ] バックエンドAPIが利用できない場合、エラートーストが表示される
- [ ] ダイアログは開いたまま
- [ ] 入力データは保持される

#### 5.2 バリデーションエラー
- [ ] サーバー側バリデーションでエラーが発生した場合、適切なエラーメッセージが表示される
- [ ] 価格が負の値の場合、エラーメッセージ
- [ ] メモが500文字を超える場合、エラーメッセージ

### 6. 統合テスト

#### 6.1 既存機能との連携
- [ ] 追加した項目を編集できる
- [ ] 追加した項目を削除できる
- [ ] 追加した項目の詳細が正しく表示される
- [ ] カルーセルで別の月に移動して戻ると、追加した項目が表示される

#### 6.2 他のユーザーとの分離
- [ ] 異なるユーザーで追加した項目は別々に表示される
- [ ] ユーザーA のデータがユーザーB に表示されない

### 7. パフォーマンステスト

- [ ] 項目追加のレスポンス時間が2秒以内
- [ ] ダッシュボード更新のレスポンス時間が3秒以内
- [ ] 100件の項目を追加してもパフォーマンスが劣化しない

### 8. アクセシビリティテスト

- [ ] キーボードのみで操作できる（Tab、Enter、Escキー）
- [ ] スクリーンリーダーで読み上げられる
- [ ] フォーカスが適切に移動する
- [ ] エラーメッセージが読み上げられる

## テスト実施の前提条件

- [ ] 環境変数が正しく設定されている
  - LINE_CHANNEL_ACCESS_TOKEN
  - LINE_CHANNEL_SECRET
  - TABLE_NAME
  - BACKEND_API（フロントエンド）

- [ ] DynamoDBテーブルが作成されている
  - テーブル名: LineBotTable
  - パーティションキー: PK
  - ソートキー: SK
  - GSI1: GSI1PK, GSI1SK

- [ ] 認証が正しく動作している
  - Amazon Cognito設定
  - JWT トークン検証

## テスト後の確認事項

- [ ] コンソールエラーがない
- [ ] ネットワークエラーがない
- [ ] メモリリークがない
- [ ] DynamoDBの課金が予想範囲内

## 既知の制限事項

1. ユーザー名はフリーテキスト入力
   - 将来的にはドロップダウンやオートコンプリートが望ましい
   
2. タイムゾーン
   - サーバーのタイムゾーンを使用（JST想定）
   
3. 同時編集
   - 複数ユーザーが同時に同じデータを編集する場合の競合解決なし

## 改善提案

1. ユーザー名の入力補完
2. デフォルト値の保存（最後に使用したカテゴリなど）
3. 一括登録機能
4. CSVインポート機能
5. 領収書画像のアップロード機能
